<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NMEA STM32 HAL LIBRARY: NMEA STM32 HAL LIBRARY</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NMEA STM32 HAL LIBRARY
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">NMEA STM32 HAL LIBRARY </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>libNMEA is a library created for the purpose of easy implementation of GPS features in your embedded system based on STM32 MCU's. It is compatible with GPS modules which are using NMEA protocol and UART communication. The library uses HAL functions so HAL must be included in your project. I used STM32CubeIDE to create this library and CubeMX to initialize MCU.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Why you should consider this library</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
Comparison to other similar libraries</h2>
<p>I have seen a lot of similar libraries on the GitHub. Unfortunately all of them have some important issues like:</p>
<ul>
<li>Properly parsing only full message (with no empty fields)</li>
<li>UART interrupt for every single incoming character</li>
<li>Lack of checksum control</li>
<li>Lack of error/status codes to interact with oder parts of the software</li>
</ul>
<h2><a class="anchor" id="autotoc_md3"></a>
Key features</h2>
<h3><a class="anchor" id="autotoc_md4"></a>
Parsing messages with empty fields</h3>
<p>I have implemented a custom parser that can return a pointer to NULL value. Thanks to it every message is parsed properly even if it contains blank fields. </p>
<h3><a class="anchor" id="autotoc_md5"></a>
UART with DMA</h3>
<p>Thanks for custom function detecting IDLE UART flag (not included in HAL) it was possible to implement data receiving with DMA. It generates only one IT for single transmission. </p>
<h3><a class="anchor" id="autotoc_md6"></a>
Checksum control</h3>
<p>Special function is calculating checksum for every incoming NMEA message and compares it with the checksum given. </p>
<h3><a class="anchor" id="autotoc_md7"></a>
Status codes returning by the functions</h3>
<p>Library functions are returning special status codes:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> {</div>
<div class="line">    <a class="code" href="libNMEA_8h.html#a6455e1040e29859f724cdef604f09a6ca271fd6e6d43f2e4ae68b0efdb6851e38">NMEA_OK</a>=0,      </div>
<div class="line">    <a class="code" href="libNMEA_8h.html#a6455e1040e29859f724cdef604f09a6ca6c7cb621af84febab9c28895b881c0a0">NMEA_BUFFER_OVERFLOWED</a>, </div>
<div class="line">    <a class="code" href="libNMEA_8h.html#a6455e1040e29859f724cdef604f09a6cac2605308bed3c5366d380a0387536331">NMEA_CHECKSUM_ERROR</a>,    </div>
<div class="line">    <a class="code" href="libNMEA_8h.html#a6455e1040e29859f724cdef604f09a6caa198a2bb859684b08d586b87e9f38d98">NMEA_WRONG_DATA</a>,    </div>
<div class="line">    <a class="code" href="libNMEA_8h.html#a6455e1040e29859f724cdef604f09a6caf52d9819bb63d8f9a3f5a1f1c5d9e9ac">NMEA_WRONG_CB_ID</a>,   </div>
<div class="line">    <a class="code" href="libNMEA_8h.html#a6455e1040e29859f724cdef604f09a6ca58c7c4496b8a08ac8640b0f9d4957590">NMEA_ERROR</a>      </div>
<div class="line">}<a class="code" href="libNMEA_8h.html#a6455e1040e29859f724cdef604f09a6c">NMEA_status</a>;</div>
<div class="ttc" id="alibNMEA_8h_html_a6455e1040e29859f724cdef604f09a6c"><div class="ttname"><a href="libNMEA_8h.html#a6455e1040e29859f724cdef604f09a6c">NMEA_status</a></div><div class="ttdeci">NMEA_status</div><div class="ttdef"><b>Definition:</b> libNMEA.h:39</div></div>
<div class="ttc" id="alibNMEA_8h_html_a6455e1040e29859f724cdef604f09a6ca271fd6e6d43f2e4ae68b0efdb6851e38"><div class="ttname"><a href="libNMEA_8h.html#a6455e1040e29859f724cdef604f09a6ca271fd6e6d43f2e4ae68b0efdb6851e38">NMEA_OK</a></div><div class="ttdeci">@ NMEA_OK</div><div class="ttdef"><b>Definition:</b> libNMEA.h:40</div></div>
<div class="ttc" id="alibNMEA_8h_html_a6455e1040e29859f724cdef604f09a6ca58c7c4496b8a08ac8640b0f9d4957590"><div class="ttname"><a href="libNMEA_8h.html#a6455e1040e29859f724cdef604f09a6ca58c7c4496b8a08ac8640b0f9d4957590">NMEA_ERROR</a></div><div class="ttdeci">@ NMEA_ERROR</div><div class="ttdef"><b>Definition:</b> libNMEA.h:45</div></div>
<div class="ttc" id="alibNMEA_8h_html_a6455e1040e29859f724cdef604f09a6ca6c7cb621af84febab9c28895b881c0a0"><div class="ttname"><a href="libNMEA_8h.html#a6455e1040e29859f724cdef604f09a6ca6c7cb621af84febab9c28895b881c0a0">NMEA_BUFFER_OVERFLOWED</a></div><div class="ttdeci">@ NMEA_BUFFER_OVERFLOWED</div><div class="ttdef"><b>Definition:</b> libNMEA.h:41</div></div>
<div class="ttc" id="alibNMEA_8h_html_a6455e1040e29859f724cdef604f09a6caa198a2bb859684b08d586b87e9f38d98"><div class="ttname"><a href="libNMEA_8h.html#a6455e1040e29859f724cdef604f09a6caa198a2bb859684b08d586b87e9f38d98">NMEA_WRONG_DATA</a></div><div class="ttdeci">@ NMEA_WRONG_DATA</div><div class="ttdef"><b>Definition:</b> libNMEA.h:43</div></div>
<div class="ttc" id="alibNMEA_8h_html_a6455e1040e29859f724cdef604f09a6cac2605308bed3c5366d380a0387536331"><div class="ttname"><a href="libNMEA_8h.html#a6455e1040e29859f724cdef604f09a6cac2605308bed3c5366d380a0387536331">NMEA_CHECKSUM_ERROR</a></div><div class="ttdeci">@ NMEA_CHECKSUM_ERROR</div><div class="ttdef"><b>Definition:</b> libNMEA.h:42</div></div>
<div class="ttc" id="alibNMEA_8h_html_a6455e1040e29859f724cdef604f09a6caf52d9819bb63d8f9a3f5a1f1c5d9e9ac"><div class="ttname"><a href="libNMEA_8h.html#a6455e1040e29859f724cdef604f09a6caf52d9819bb63d8f9a3f5a1f1c5d9e9ac">NMEA_WRONG_CB_ID</a></div><div class="ttdeci">@ NMEA_WRONG_CB_ID</div><div class="ttdef"><b>Definition:</b> libNMEA.h:44</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8"></a>
Callback functions for events</h3>
<p>I have implemented a system of callback functions for some events. Using it you can realize measurements, warnings etc. At the moment you can register callbacks for 3 events:</p><ul>
<li>speed change</li>
<li>upward speed limit violation</li>
<li>downward speed limit violation</li>
</ul>
<p>For more information see code documentation.</p>
<h3><a class="anchor" id="autotoc_md9"></a>
All data close at hand</h3>
<p>nmea_data is instance of <a class="el" href="structNMEA__data.html">NMEA_data</a> structer. You have acces to it in your code to acces important and actual data whenever you need. </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span>{</div>
<div class="line">    <span class="keywordtype">float</span>       UTC_time; </div>
<div class="line">    <span class="keywordtype">int</span>         UT_date;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">float</span>       latitude;</div>
<div class="line">    <span class="keywordtype">char</span>        latitude_direction;</div>
<div class="line">    <span class="keywordtype">float</span>       longitude;</div>
<div class="line">    <span class="keywordtype">char</span>        longitude_direction;</div>
<div class="line">    <span class="keywordtype">float</span>       altitude;</div>
<div class="line">    <span class="keywordtype">float</span>       geoidal_separation;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">float</span>       speed_kmph;</div>
<div class="line">    <span class="keywordtype">float</span>       speed_knots;</div>
<div class="line">    </div>
<div class="line">    uint8_t     sat_in_view;</div>
<div class="line">    uint8_t     sat_in_use;</div>
<div class="line">    </div>
<div class="line">    uint8_t     fix;</div>
<div class="line">    uint8_t     fix_mode;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">float</span>       PDOP;</div>
<div class="line">    <span class="keywordtype">float</span>       HDOP;</div>
<div class="line">    <span class="keywordtype">float</span>       VDOP;</div>
<div class="line"> </div>
<div class="line">}<a class="code" href="structNMEA__data.html">NMEA_data</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="structNMEA__data.html">NMEA_data</a> <a class="code" href="libNMEA_8h.html#a385a22547d1d9ec0c2cb0066b185c4b4">nmea_data</a>;</div>
<div class="ttc" id="alibNMEA_8h_html_a385a22547d1d9ec0c2cb0066b185c4b4"><div class="ttname"><a href="libNMEA_8h.html#a385a22547d1d9ec0c2cb0066b185c4b4">nmea_data</a></div><div class="ttdeci">NMEA_data nmea_data</div><div class="ttdef"><b>Definition:</b> libNMEA.h:180</div></div>
<div class="ttc" id="astructNMEA__data_html"><div class="ttname"><a href="structNMEA__data.html">NMEA_data</a></div><div class="ttdef"><b>Definition:</b> libNMEA.h:52</div></div>
</div><!-- fragment --><p> For more information see code documentation.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Integrating library with your code</h1>
<p>In CubeMX follow these steps:</p><ul>
<li>Select UART/USART port for your GPS module</li>
<li>Select async mode</li>
<li>Turn on global interrupt</li>
<li>Select DMA channel for UART/USART RX</li>
<li>Generate Code</li>
</ul>
<p>In the "libNMEA.h" file change</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;stm32l4xx_hal.h&quot;</span></div>
</div><!-- fragment --><p>to file specific to your hardware.</p>
<p>In the "main.h" add</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="libNMEA_8h.html">libNMEA.h</a>&quot;</span></div>
<div class="ttc" id="alibNMEA_8h_html"><div class="ttname"><a href="libNMEA_8h.html">libNMEA.h</a></div></div>
</div><!-- fragment --><p>in user includes section</p>
<p>In file "stm32XXxx_it.c" specific for your hardware place</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> UART4_IRQHandler(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//USER CODE BEGIN UART4_IRQn 0</span></div>
<div class="line">    </div>
<div class="line">    <a class="code" href="libNMEA_8c.html#a12e9ebb3cb9f8b25b7e10666fb3c49d4">user_UART_IDLE_IT_handler</a>();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">//USER CODE END UART4_IRQn 0</span></div>
<div class="line"> </div>
<div class="line">    ...</div>
<div class="ttc" id="alibNMEA_8c_html_a12e9ebb3cb9f8b25b7e10666fb3c49d4"><div class="ttname"><a href="libNMEA_8c.html#a12e9ebb3cb9f8b25b7e10666fb3c49d4">user_UART_IDLE_IT_handler</a></div><div class="ttdeci">NMEA_status user_UART_IDLE_IT_handler(void)</div><div class="ttdef"><b>Definition:</b> libNMEA.c:314</div></div>
</div><!-- fragment --><p> In the main function after peripheria initialization place</p>
<div class="fragment"><div class="line"><a class="code" href="libNMEA_8c.html#a4512ff2b1b47cf5b15b0c80610a59096">NMEA_init</a>(&amp;huart4, &amp;hdma_uart4_rx);   <span class="comment">/*library initialization. Pass the UART and DMA handler structures*/</span></div>
<div class="ttc" id="alibNMEA_8c_html_a4512ff2b1b47cf5b15b0c80610a59096"><div class="ttname"><a href="libNMEA_8c.html#a4512ff2b1b47cf5b15b0c80610a59096">NMEA_init</a></div><div class="ttdeci">void NMEA_init(UART_HandleTypeDef *huart, DMA_HandleTypeDef *DMA)</div><div class="ttdef"><b>Definition:</b> libNMEA.c:235</div></div>
</div><!-- fragment --><p>with handlers to defined structures and</p>
<div class="fragment"><div class="line"><span class="comment">/* Infinite loop */</span></div>
<div class="line"><span class="comment">/* USER CODE BEGIN WHILE */</span></div>
<div class="line"><span class="keywordflow">while</span> (1)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="libNMEA_8c.html#a3de145f81ae94d22ed27c673b9e8b08d">NMEA_process_task</a>();  <span class="comment">/*library process. PLACE IT IN THE MAIN LOOP! Note that you should handle the status codes.*/</span></div>
<div class="ttc" id="alibNMEA_8c_html_a3de145f81ae94d22ed27c673b9e8b08d"><div class="ttname"><a href="libNMEA_8c.html#a3de145f81ae94d22ed27c673b9e8b08d">NMEA_process_task</a></div><div class="ttdeci">NMEA_status NMEA_process_task(void)</div><div class="ttdef"><b>Definition:</b> libNMEA.c:303</div></div>
</div><!-- fragment --><p>inside the infinitive loop.</p>
<p>Thats it! Now you are ready to use GPS features in your embedded system!</p>
<p>Check out the example "main.c" to understand how to play with callback functions.</p>
<p>I highly recommend to read the documentation when you clone the repository (e.g. "html/index.html") and read the source before integration with the system process.</p>
<p>For more complex example check out <a href="https://github.com/mpalka31/NMEA_test">this project</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
